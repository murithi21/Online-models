<!DOCTYPE html>
<html>
<head>
<style>
  .container { display: flex; gap: 20px; margin-bottom: 20px; }
  .dropzone {
    width: 150px; height: 150px;
    border: 2px dashed #999; border-radius: 10px;
    display: flex; justify-content: center; align-items: center;
  }
  .draggable {
    width: 80px; height: 80px; background: #2196f3; color: #fff;
    display: flex; justify-content: center; align-items: center;
    border-radius: 8px; cursor: grab;
  }
  button {
    padding: 10px 20px; background: #f44336; color: white;
    border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
  }
  button:disabled { background: #aaa; cursor: not-allowed; }
</style>
</head>
<body>

<h2>Drag & Drop with Up To 3 Undo Steps</h2>

<div class="container">
  <div class="dropzone" id="zone1">Zone 1</div>
  <div class="dropzone" id="zone2">Zone 2</div>
  <div class="dropzone" id="zone3">Zone 3</div>
</div>

<div id="items">
  <div class="draggable" draggable="true" id="item1">Item 1</div>
  <div class="draggable" draggable="true" id="item2">Item 2</div>
  <div class="draggable" draggable="true" id="item3">Item 3</div>
  <div class="draggable" draggable="true" id="item4">Item 4</div>
</div>

<br>
<button id="undoBtn" disabled>Undo Last Step</button>

<script>
  const historyStack = []; // store up to last 3 actions
  const MAX_HISTORY = 3;

  const draggables = document.querySelectorAll('.draggable');
  const dropzones = document.querySelectorAll('.dropzone');
  const undoBtn = document.getElementById('undoBtn');

  draggables.forEach(item => {
    item.addEventListener('dragstart', e => {
      e.dataTransfer.setData('itemId', item.id);
    });
  });

  dropzones.forEach(zone => {
    zone.addEventListener('dragover', e => e.preventDefault());

    zone.addEventListener('drop', e => {
      e.preventDefault();
      const itemId = e.dataTransfer.getData('itemId');
      const item = document.getElementById(itemId);
      const oldParent = item.parentElement;

      // Save history entry
      historyStack.push({
        item,
        oldParent,
        newParent: zone
      });

      // Limit history to last 3
      if (historyStack.length > MAX_HISTORY) {
        historyStack.shift();
      }

      // Move item
      zone.appendChild(item);
      undoBtn.disabled = false;
    });
  });

  undoBtn.addEventListener('click', () => {
    if (historyStack.length === 0) return;

    const lastAction = historyStack.pop();
    const { item, oldParent } = lastAction;

    oldParent.appendChild(item);

    if (historyStack.length === 0) {
      undoBtn.disabled = true;
    }
  });
</script>

</body>
</html>
